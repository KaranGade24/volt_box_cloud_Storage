// export const FilesData = [
//   {
//     _id: "1",
//     uploadedBy: "",
//     name: "Sample PDF Document.pdf",
//     type: "pdf",
//     mimeType: "application/pdf",
//     size: "30 KB",
//     createdAt: "2024-01-15T10:30:00.000Z",
//     isFavorite: false,
//     tags: ["document", "pdf", "sample"],
//     url: "https://www.africau.edu/images/default/sample.pdf",
//     isAlbumFile: false,
//     AlbumId: "123",
//   },
//   {
//     _id: "2",
//     name: "Sample Image.jpg",
//     type: "jpg",
//     mimeType: "image/jpeg",
//     size: "100 KB",
//     createdAt: "2023-11-20T14:45:00.000Z",
//     isFavorite: false,
//     tags: ["image", "photo", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_JPG_100kB.jpg",
//   },
//   {
//     _id: "3",
//     name: "Sample Video.mp4",
//     type: "mp4",
//     mimeType: "video/mp4",
//     size: "5.3 MB",
//     createdAt: "2024-06-01T08:00:00.000Z",
//     isFavorite: false,
//     tags: ["video", "sample", "movie"],
//     url: "https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4",
//   },
//   {
//     _id: "4",
//     name: "Sample Document.docx",
//     type: "docx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
//     size: "100 KB",
//     createdAt: "2023-09-10T11:15:00.000Z",
//     isFavorite: false,
//     tags: ["document", "word", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.docx",
//   },
//   {
//     _id: "5",
//     name: "Sample Text File.txt",
//     type: "txt",
//     mimeType: "text/plain",
//     size: "4 KB",
//     createdAt: "2024-03-25T09:00:00.000Z",
//     isFavorite: false,
//     tags: ["text", "document", "plain"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_1KB.txt",
//   },
//   {
//     _id: "6",
//     name: "Sample Audio.mp3",
//     type: "mp3",
//     mimeType: "audio/mpeg",
//     size: "2.5 MB",
//     createdAt: "2023-07-05T16:20:00.000Z",
//     isFavorite: false,
//     tags: ["audio", "music", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_250KB.mp3",
//   },
//   {
//     _id: "7",
//     name: "Sample Data.csv",
//     type: "csv",
//     mimeType: "text/csv",
//     size: "1 KB",
//     createdAt: "2024-02-29T13:00:00.000Z",
//     isFavorite: false,
//     tags: ["data", "spreadsheet", "csv"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_CSV_1000.csv",
//   },
//   {
//     _id: "8",
//     name: "Sample PNG Image.png",
//     type: "png",
//     mimeType: "image/png",
//     size: "17 KB",
//     createdAt: "2023-12-12T07:30:00.000Z",
//     isFavorite: false,
//     tags: ["image", "graphic", "png"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_PNG_500kB.png",
//   },
//   {
//     _id: "9",
//     name: "Sample Presentation.pptx",
//     type: "pptx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.presentationml.presentation",
//     size: "50 KB",
//     createdAt: "2024-05-18T17:00:00.000Z",
//     isFavorite: false,
//     tags: ["presentation", "powerpoint", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.pptx",
//   },
//   {
//     _id: "10",
//     name: "Sample Spreadsheet.xlsx",
//     type: "xlsx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
//     size: "100 KB",
//     createdAt: "2023-10-01T09:40:00.000Z",
//     isFavorite: false,
//     tags: ["spreadsheet", "excel", "data"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_XLSX_100.xlsx",
//   },
//   {
//     _id: "11",
//     name: "Sample PDF Document.pdf",
//     type: "pdf",
//     mimeType: "application/pdf",
//     size: "30 KB",
//     createdAt: "2024-01-15T10:30:00.000Z",
//     isFavorite: false,
//     tags: ["document", "pdf", "sample"],
//     url: "https://www.africau.edu/images/default/sample.pdf",
//   },
//   {
//     _id: "12",
//     name: "Sample Image.jpg",
//     type: "jpg",
//     mimeType: "image/jpeg",
//     size: "100 KB",
//     createdAt: "2023-11-20T14:45:00.000Z",
//     isFavorite: false,
//     tags: ["image", "photo", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_JPG_100kB.jpg",
//   },
//   {
//     _id: "13",
//     name: "Sample Video.mp4",
//     type: "mp4",
//     mimeType: "video/mp4",
//     size: "5.3 MB",
//     createdAt: "2024-06-01T08:00:00.000Z",
//     isFavorite: false,
//     tags: ["video", "sample", "movie"],
//     url: "https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4",
//   },
//   {
//     _id: "14",
//     name: "Sample Document.docx",
//     type: "docx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
//     size: "100 KB",
//     createdAt: "2023-09-10T11:15:00.000Z",
//     isFavorite: false,
//     tags: ["document", "word", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.docx",
//   },
//   {
//     _id: "15",
//     name: "Sample Text File.txt",
//     type: "txt",
//     mimeType: "text/plain",
//     size: "4 KB",
//     createdAt: "2024-03-25T09:00:00.000Z",
//     isFavorite: false,
//     tags: ["text", "document", "plain"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_1KB.txt",
//   },
//   {
//     _id: "16",
//     name: "Sample Audio.mp3",
//     type: "mp3",
//     mimeType: "audio/mpeg",
//     size: "2.5 MB",
//     createdAt: "2023-07-05T16:20:00.000Z",
//     isFavorite: false,
//     tags: ["audio", "music", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_250KB.mp3",
//   },
//   {
//     _id: "17",
//     name: "Sample Data.csv",
//     type: "csv",
//     mimeType: "text/csv",
//     size: "1 KB",
//     createdAt: "2024-02-29T13:00:00.000Z",
//     isFavorite: false,
//     tags: ["data", "spreadsheet", "csv"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_CSV_1000.csv",
//   },
//   {
//     _id: "18",
//     name: "Sample PNG Image.png",
//     type: "png",
//     mimeType: "image/png",
//     size: "17 KB",
//     createdAt: "2023-12-12T07:30:00.000Z",
//     isFavorite: false,
//     tags: ["image", "graphic", "png"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_PNG_500kB.png",
//   },
//   {
//     _id: "19",
//     name: "Sample Presentation.pptx",
//     type: "pptx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.presentationml.presentation",
//     size: "50 KB",
//     createdAt: "2024-05-18T17:00:00.000Z",
//     isFavorite: false,
//     tags: ["presentation", "powerpoint", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.pptx",
//   },
//   {
//     _id: "20",
//     name: "Sample Spreadsheet.xlsx",
//     type: "xlsx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
//     size: "100 KB",
//     createdAt: "2023-10-01T09:40:00.000Z",
//     isFavorite: false,
//     tags: ["spreadsheet", "excel", "data"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_XLSX_100.xlsx",
//   },
//   {
//     _id: "21",
//     name: "Sample PDF Document.pdf",
//     type: "pdf",
//     mimeType: "application/pdf",
//     size: "30 KB",
//     createdAt: "2024-01-15T10:30:00.000Z",
//     isFavorite: false,
//     tags: ["document", "pdf", "sample"],
//     url: "https://www.africau.edu/images/default/sample.pdf",
//   },
//   {
//     _id: "22",
//     name: "Sample Image.jpg",
//     type: "jpg",
//     mimeType: "image/jpeg",
//     size: "100 KB",
//     createdAt: "2023-11-20T14:45:00.000Z",
//     isFavorite: false,
//     tags: ["image", "photo", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_JPG_100kB.jpg",
//   },
//   {
//     _id: "23",
//     name: "Sample Video.mp4",
//     type: "mp4",
//     mimeType: "video/mp4",
//     size: "5.3 MB",
//     createdAt: "2024-06-01T08:00:00.000Z",
//     isFavorite: false,
//     tags: ["video", "sample", "movie"],
//     url: "https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4",
//   },
//   {
//     _id: "24",
//     name: "Sample Document.docx",
//     type: "docx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
//     size: "100 KB",
//     createdAt: "2023-09-10T11:15:00.000Z",
//     isFavorite: false,
//     tags: ["document", "word", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.docx",
//   },
//   {
//     _id: "25",
//     name: "Sample Text File.txt",
//     type: "txt",
//     mimeType: "text/plain",
//     size: "4 KB",
//     createdAt: "2024-03-25T09:00:00.000Z",
//     isFavorite: false,
//     tags: ["text", "document", "plain"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_1KB.txt",
//   },
//   {
//     _id: "26",
//     name: "Sample Audio.mp3",
//     type: "mp3",
//     mimeType: "audio/mpeg",
//     size: "2.5 MB",
//     createdAt: "2023-07-05T16:20:00.000Z",
//     isFavorite: false,
//     tags: ["audio", "music", "sample"],
//     url: "https://file-examples.com/wp-content/uploads/2017/11/file_example_MP3_250KB.mp3",
//   },
//   {
//     _id: "27",
//     name: "Sample Data.csv",
//     type: "csv",
//     mimeType: "text/csv",
//     size: "1 KB",
//     createdAt: "2024-02-29T13:00:00.000Z",
//     isFavorite: false,
//     tags: ["data", "spreadsheet", "csv"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_CSV_1000.csv",
//   },
//   {
//     _id: "28",
//     name: "Sample PNG Image.png",
//     type: "png",
//     mimeType: "image/png",
//     size: "17 KB",
//     createdAt: "2023-12-12T07:30:00.000Z",
//     isFavorite: false,
//     tags: ["image", "graphic", "png"],
//     url: "https://file-examples.com/wp-content/uploads/2017/10/file_example_PNG_500kB.png",
//   },
//   {
//     _id: "29",
//     name: "Sample Presentation.pptx",
//     type: "pptx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.presentationml.presentation",
//     size: "50 KB",
//     createdAt: "2024-05-18T17:00:00.000Z",
//     isFavorite: false,
//     tags: ["presentation", "powerpoint", "office"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file-sample_100kB.pptx",
//   },
//   {
//     _id: "30",
//     name: "Sample Spreadsheet.xlsx",
//     type: "xlsx",
//     mimeType:
//       "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
//     size: "100 KB",
//     createdAt: "2023-10-01T09:40:00.000Z",
//     isFavorite: false,
//     tags: ["spreadsheet", "excel", "data"],
//     url: "https://file-examples.com/wp-content/uploads/2017/02/file_example_XLSX_100.xlsx",
//   },
// ];

export const parseFileSize = (sizeStr) => {
  if (!sizeStr || typeof sizeStr !== "string") return 0;

  const [valueStr, unitRaw] = sizeStr.trim().split(" ");
  const value = parseFloat(valueStr);
  const unit = unitRaw?.toUpperCase();
  if (isNaN(value)) return 0;

  switch (unit) {
    case "BYTES":
    case "B":
      return value;
    case "KB":
      return value * 1024;
    case "MB":
      return value * 1024 * 1024;
    case "GB":
      return value * 1024 * 1024 * 1024;
    case "TB":
      return value * 1024 * 1024 * 1024 * 1024;
    default:
      return 0;
  }
};

export const formatFileSize = (bytes) => {
  if (typeof bytes !== "number" || isNaN(bytes) || bytes < 0) return "0 B";

  const units = ["B", "KB", "MB", "GB", "TB"];
  let index = 0;

  while (bytes >= 1024 && index < units.length - 1) {
    bytes /= 1024;
    index++;
  }

  return `${bytes.toFixed(1)} ${units[index]}`;
};

export const INITIAL_STATE = {
  files: [],
  loading: false,
  originalFiles: [],
  count: 0,
};

function FileReducer(state, action) {
  switch (action.type) {
    case "INITIATE_FILE": {
      return {
        ...state,
        files: action.payload.files, // fresh list from server
        count: action.payload.count,
        originalFiles: action.payload.files,
      };
    }
    case "ADD_FILE": {
      console.log({ a: [...action.payload, ...state.files] });
      return {
        ...state,
        files: [...action.payload, ...state.files], // add a new file to the top
      };
    }
    case "RENAME_FILE": {
      const { fileId, newName } = action.payload;
      const updatedFiles = state.files.map((file) => {
        if (file._id === fileId) {
          return { ...file, name: newName };
        }
        return file;
      });
      return {
        ...state,
        files: updatedFiles,
      };
    }
    case "DELETE_FILE":
      const fileId = action.payload.fileId;
      const updatedFiles = state.files.filter((file) => file._id !== fileId);
      return {
        ...state,
        files: updatedFiles,
      };
    case "SEARCH_FILES":
      const searchTerm = action.payload.searchTerm;
      if (searchTerm.trim() === "") {
        return {
          ...state,
          files: state.originalFiles,
        };
      }
      const filteredFiles = state.originalFiles.filter((file) => {
        return file.name.toLowerCase().includes(searchTerm.toLowerCase());
      });
      return {
        ...state,
        files: filteredFiles,
      };
    case "SORT_FILES":
      const sortType = action.payload.sortType;
      const sortedFiles = [...state.files]; // clone to avoid mutation
      switch (sortType) {
        case "newest":
          sortedFiles.sort(
            (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
          );
          break;
        case "oldest":
          sortedFiles.sort(
            (a, b) => new Date(a.createdAt) - new Date(b.createdAt)
          );
          break;
        case "name":
          sortedFiles.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case "size":
          sortedFiles.sort(
            (a, b) => parseFileSize(b.size) - parseFileSize(a.size)
          );
          break;
        case "date":
          sortedFiles.sort(
            (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
          );
          break;
        case "CLEAR_FILTER":
          return {
            ...state,
            files: state.originalFiles,
          };
          break;
        default:
          return state;
      }
      return {
        ...state,
        files: sortedFiles,
      };
    default:
      return state;
  }
}

export default FileReducer;
